---
layout: post
title:  "ssh connection"
date:   2024-01-05 11:20:55 +0800
categories: [Tech]
excerpt: options for ssh, tunel and so on. 
tags:
  - ssh
  - network
---

`SSH` is abbreviation of `Secure Shell`. This post is based on `Ubuntu 20`.

### install SSH 
install SSH-clinet
```bash
sudo apt-get install openssh-client
```
install SSH-server
```bash
sudo apt-get install openssh-server
```

### connection
##### 1. without option
```bash
ssh 192.168.1.100
```
Default username is that in current terminal. Or you can specify username as below
```bash
ssh qing@192.168.1.100
```
Usually, we connect with specific username.

##### 2. port
Default posr for SSH is 22. We can specify port as need.
```bash
ssh -p 123 qing@192.168.1.100
```
It's same with cmd below
```bash
ssh qing@192.168.1.100 -p 123
```

##### 3. compress
Compress all data transferred by ssh.
```bash
ssh -C qing@192.168.1.100
```
<!-- If compress and specify port
```bash
ssh -pC 123 qing@192.168.1.100
``` -->

##### specify config
Connect with specific configuration file.
```bash
ssh -F qing@192.168.1.100
```


```bash
```


### configuration
Default configuration file is `/etc/ssh/ssh_config`.
##### keep connection
ssh will be terminated if it's idle for a long time. If we want to keep connection, add txt below to configuration file. 
```bash
ServerAliveInterval 60
```
Client will send a message to server  to make connection alive if no data is transferred for interval(here it's 60 seconds). 

##### X11 forwarding
If you want to display application on client computer, you should set `ForwardX11` as `yes`.
Find this option in configuration file and set it. If there isn't this option, just add txt below to the tail of configuration file. 
```bash
ForwardX11 yes
```


### port forwarding
Refer to [here](https://zhuanlan.zhihu.com/p/615584874?utm_id=0#)

|option||
|---|---|
|`-L`|local|
|`-R`|remote|
|`-D`|dynamic|

Assume that we have 3 Host(computer), A, B and C.

|host|position|port|
|---|---|---|
|A|destination|X|
|B|remote|Y|
|C|local|Z|

![port forwarding](/assets/images/posts/ssh/port-forwarding.png)


##### -R

```bash
ssh -R portY:hostC:portZ user@ip
```

example:  
Perform cmd below on host A
```bash
ssh -R 8080:localhost:80 root@hostB
```
Now we can access host A by accessing `hostB:8080`. 
Note that you should make sure that `GatewayPorts` in ssh configuration file on hostB has been set as `yes`. If you change this configuration, you should restart `sshd` to enable it.

